type: custom:button-card
variables:
  alarmcardversion: 1.0.1
  var_alarm_name: |-
    [[[
      var assistbid = localStorage.getItem("view_assist_sensor") ?? variables.default_satellite;
      var alarm_name = hass.states[assistbid].attributes.alarm_name;
      try {return `${alarm_name}`;} catch { return  ""}
    ]]]
  var_difference: >-
    [[[ 
      try {
    var assistbid = localStorage.getItem("view_assist_sensor") ??
    variables.default_satellite;

    var expires = hass.states[assistbid].attributes.display_timer_expire;

    const expireDate = new Date(expires);

    const currentDate = new Date();

    const diffMs =  expireDate - currentDate;


    // Get absolute value for calculations and track if negative

    const isNegative = diffMs < 0;

    const absDiffMs = Math.abs(diffMs);


    // Convert to seconds

    const totalSeconds = Math.floor(absDiffMs / 1000);


    // Calculate hours, minutes, seconds

    const hours = Math.floor(totalSeconds / 3600);

    const minutes = Math.floor((totalSeconds % 3600) / 60);

    const seconds = totalSeconds % 60;


    // Format with leading zeros

    const formattedTime = [
      String(hours).padStart(2, '0'),
      String(minutes).padStart(2, '0'),
      String(seconds).padStart(2, '0')
    ].join(':');


    // Add negative sign only at beginning if needed

    return isNegative ? `-${formattedTime}` : formattedTime;

    } catch { return "00:00:00" }

    ]]]   
template:
  - variable_template
  - body_template
styles:
  grid:
    - grid-template-areas: |
        "title status"
        "alarm_name alarm_name"
        "time time"
        "snooze dismiss"
        "assist assist"
    - grid-template-rows: .5fr min-content min-content min-content min-content
    - grid-template-columns: 1fr 1fr
  card:
    - background-size: cover
    - background-color: "#24292c"
  custom_fields:
    alarm_name:
      - justify-self: center
      - z-index: 1
      - font-size: 10vh
      - position: grid
      - color: white
      - align-content: end
    time:
      - justify-self: center
      - z-index: 1
      - font-size: 45vh
      - font-weight: bold
      - position: grid
      - color: white
    snooze:
      - justify-self: center
      - align-self: center
      - z-index: 1
      - font-size: 15vh
      - width: max-content
      - position: grid
      - top: 70%
    dismiss:
      - justify-self: center
      - align-self: center
      - z-index: 1
      - font-size: 15vh
      - width: max-content
      - position: grid
      - top: 70%
custom_fields:
  title: " "
  alarm_name: "[[[ return variables.var_difference ]]]"
  time: "[[[ return variables.var_current_time ]]]"
  snooze:
    card:
      type: custom:button-card
      name: Snooze
      show_icon: false
      show_name: true
      tap_action:
        action: call-service
        service: view_assist.broadcast_event
        service_data:
          event_name: viewassist
          event_data:
            command: snooze alarm
            entity_id: "[[[ return variables.var_assistsat_entity ]]]"
            mic_device: >-
              [[[ return
              hass.states[variables.var_assistsat_entity].attributes.mic_device
              ]]]
      styles:
        card:
          - display: flex
          - justify-content: center
          - align-items: center
          - width: 30vw
          - height: 10vh
          - border-radius: 5vw
          - border: none
          - background-color: white
        name:
          - font-size: 5vh
          - color: black
          - font-weight: bold
          - text-align: center
  dismiss:
    card:
      type: custom:button-card
      name: Dismiss
      show_icon: false
      show_name: true
      tap_action:
        action: call-service
        service: view_assist.broadcast_event
        service_data:
          event_name: viewassist
          event_data:
            command: dismiss alarm
            entity_id: "[[[ return variables.var_assistsat_entity ]]]"
      styles:
        card:
          - display: flex
          - justify-content: center
          - align-items: center
          - width: 30vw
          - height: 10vh
          - border-radius: 5vh
          - color: white
          - border: none
          - background-color: "#2899f3"
        name:
          - font-size: 5vh
          - color: white
          - font-weight: bold
          - text-align: center
